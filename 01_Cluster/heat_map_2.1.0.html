<!DOCTYPE html>
<html>
 
  <head>
  
	<link rel="icon" href="favicon.ico" />
    <style>
	
	body{ padding:0px; max-width:1500px; margin: 0 auto;  font-family:Source Sans Pro, sans-serif;  font-size:100%;}
	#header{ background:#fff  ; width:100%; display:inline-block; position:relative; margin-top:10px;     z-index: 24;}
	
	/*Main Title*/
		#header div {float: left;padding-bottom: 10px; width:100%;}
		#header div h1{ margin-bottom:0px; }
		#header div h1 a{ display:block;text-align:center; color:#000;  text-decoration:none;outline: none;}
		#header div.desc{ text-align:center;  font-size:1em;}
	
	#option {
	
	text-align: center;
    margin: 10px auto;
	
	}
	
	form {
		display:inline-block;
		max-width:350px;
		margin-right:50px;

	}
	

	
	form h4{
		text-align:center;
		margin: 5px;
	}
		
	    .custom-radio{
        width: 16px;
        height: 16px;
        display: inline-block;
        position: relative;
        z-index: 1;
        top: 3px;
    }
    .custom-radio:hover{            
    }
    .custom-radio.selected{
    }
    .custom-radio input[type="radio"]{
        margin: 1px;
        position: absolute;
        z-index: 2;            
        cursor: pointer;
        outline: none;
        opacity: 0;
        /* CSS hacks for older browsers */
        _noFocusLine: expression(this.hideFocus=true); 
        -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
        filter: alpha(opacity=0);
        -khtml-opacity: 0;
        -moz-opacity: 0;
    }
	
      rect.bordered   {
        stroke: #303030;
        stroke-width:0.5px;   
      }
	  
	  rect.highlighted {
		stroke: #F00;
        stroke-width:1px;
	  }
	  
      text.mono {
        font-size: 9pt;
        font-family:  sans-serif;
        fill: #000000;
		shape-rendering: crispEdges;
      }

      text.axis-workweek {
        fill: #000;
      }

      text.axis-worktime {
        fill: #000;
      }
	  
	  text.text-highlight_green {
        fill: #1b7415;
      }
	  
	  text.text-highlight_orange {
        fill: #f23407;
      }
	  
	  text.text-highlight_blue {
        fill: #0041DB;
      }
	  
	  
	  .axis path,
	  .axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}

	.axis text {
		font-family: sans-serif;
		font-size: 11px;
	}
	
	.axis2 path,
	  .axis2 line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}

	.axis2 text {
		font-family: sans-serif;
		font-size: 11px;
	}

	div.tooltip {   
	  position: absolute;           
	  text-align: center;           
	  width: 100px;                  
	  height: 60px;                 
	  padding: 2px;             
	  font: 12px sans-serif;        
	  background: lightsteelblue;   
	  border: 0px;      
	  border-radius: 8px;           
	  pointer-events: none;         
	}

    </style>
	<title> Cancer and HDI </title>
	<script type="text/javascript" src="d3/d3.v3.min.js"></script>
	
	
		<script type="text/javascript">
		
		// variable general
		
		var nb_country = 173;
				
		var margin = { top: 100, right: 200, bottom: 100, left: 300, top_page: 50, left_page: 400 },
			width = 1500 - margin.left - margin.right,
			height = 800 - margin.top - margin.bottom,
			XgridSize = Math.floor(width / nb_country),
			YgridSize = Math.floor(height / 28);
			
		var element_display = true;
		var Flag_selected_country = false;	
		var hdi_label = ["Low HDI", "Medium HDI", "High HDI", "Very high HDI"];
		var area_label = ["Africa", "Latin America & the Carribean", "North America", "Asia", "Europe", "Oceania"];
		
		var color_hdi = ["#E8EEFE",  "#A9C3FF", "#2E75D1", "#00329F"]; // 
		var color_area = ["#D62702","#D62702","#D62702","#D62702","#D62702" // Africa: East, middle, Northenr, south, western
						 ,"#AC0EAF","#AC0EAF","#AC0EAF" // Caribbean, Central America, South America
						 ,"#462E94" // north America
						,"#E4D901","#E4D901","#E4D901", "#E4D901" // Asia: east, south east, south, western
								,"#01ACE9","#01ACE9","#01ACE9", "#01ACE9" //Europe: east, north, south, west
								,"#05AD18","#05AD18","#05AD18", "#05AD18"];
		var color_area_legend = ["#D62702",  "#AC0EAF", "#462E94", "#E4D901", "#01ACE9", "#05AD18"]; // 
		

		
		var color_cancer = {};
		color_cancer["Bladder"]                = "#278D29";
		color_cancer["Brain, nervous system"]  = "#D5BED2";
		color_cancer["Breast"]                 = "#FF68BC";
		color_cancer["Cervix uteri"]           = "#FF7500";
		color_cancer["Colorectum"]             = "#FFD803";
		color_cancer["Corpus uteri"]           = "#9FE72D";
		color_cancer["Gallbladder"]            = "#006158";
		color_cancer["Hodgkin lymphoma"]       = "#97d5b4";
		color_cancer["Kaposi sarcoma"]         = "#FFC2CA";
		color_cancer["Kidney"]                 = "#040186";
		color_cancer["Larynx"]                 = "#aec80d";
		color_cancer["Leukaemia"]              = "#FFFFA6";
		color_cancer["Lip, oral cavity"]       = "#AE563E";
		color_cancer["Liver"]                  = "#F3A654";
		color_cancer["Lung"]                   = "#1E90FF";
		color_cancer["Melanoma of skin"]       = "#cd100a";
		color_cancer["Multiple myeloma"]       = "#333333";
		color_cancer["Nasopharynx"]            = "#2A4950";
		color_cancer["Non-Hodgkin lymphoma"]   = "#2231D0";
		color_cancer["Oesophagus"]             = "#DC1341";
		color_cancer["Other pharynx"]          = "#6D8A6D";
		color_cancer["Ovary"]                  = "#00F5B6";
		color_cancer["Pancreas"]               = "#940009";
		color_cancer["Prostate"]               = "#34A76E";
		color_cancer["Stomach"]                = "#4682B4";
		color_cancer["Testis"]                 = "#3a1ad1";
		color_cancer["Thyroid"]                = "#ADD9E4";
		

		var heatMap; // not sure it need to be initialize ?
		var row_select = "Alphabetic";
		var fill_select = "hdi";
		var sex_select = "Women";	
		var nb_site_max = 25;  
		var transitionTime = 1500;
		var label_padding = -3; // label of the cancer site distance from heatmaps
		
		 var xScale = d3.scale.linear()
		.domain([1, nb_country])
		.range([0  ,(nb_country-1)* XgridSize ]);
		
					
		var yScale = d3.scale.linear()
		.domain([1, nb_site_max])
		.range([0  ,(nb_site_max-1)* YgridSize ]);
		
		var yScale2 = d3.scale.linear()
			.domain([0, 1])
			.range([(nb_site_max)* YgridSize   ,0]);
			
		rev_yScale2 = function(v) {
		
			return yScale2(0) - yScale2(v);
		
		}
		
												  
	
	 window.onload = function()
		{
		Heatmap_gen()
		
	};

	
	function combo_row(order)
	 {
		
	   row_select = order;
	   sortBars();
	}
	
	function combo_fill(fill)
	 {

	   fill_select = fill;
	   area_fill()
	}
	

 	function combo_sex(sex)
	{

	   sex_select = sex;
	   d3.selectAll("svg").remove();
 	   // document.getElementById('radio_cluster_off').checked= true;
	   document.getElementById('radio_cluster_on').checked= false;
	   document.getElementById('radio_cluster_off').checked= true;
	   document.getElementById('radio_color_hdi').checked= true;
	   document.getElementById('radio_color_area').checked= false;
	   document.getElementById('countryList').selectedIndex = 0;
	   Flag_selected_country = false;
	   Heatmap_gen();
	   
	}
	
    function Heatmap_gen() // generate heatmap 
	{ 	
	row_select = "Alphabetic";
		if (sex_select == "Women") {
				
			var file_use = "data/HDI_ASR_women_new.csv"; 
			var nb_site = 25;  

			
			
		}
				
		else {

			var file_use = "data/HDI_ASR_men_new.csv"; 
			var nb_site = 23;
	
			
		}

		
		d3.csv(file_use,
			
			function(d) {
			return {
				
				cl_ord : +d.cl_ord,
				cancer : d.cancer,
				area : d.area,
				area_code : +d.area_code,
				label_country: d.label_country,
				asr: +d.asr,
				worldrank: +d.worldrank,
				hdi_group: +d.hdi_group,
				cancer_code: +d.cancer_code,
				hdi_value: +d.hdi_value,
				cases: +d.cases,
				country_code: +d.country_code

				
				
				};	
			},		
			function(data) {
			
			var data_cancer=d3.nest()
				.key(function(d) {return d.cancer;})
				.sortKeys(d3.ascending)
				.entries(data)
			

			bar_stack = bar_stack_data(data, data_cancer);

			
			populateComboCountry(data);
		
			var xAxis = d3.svg.axis() 
                  .scale(xScale)
                  .orient("bottom")
				  .tickValues([1, 20, 40, 60, 80, 100, 120,140,160,nb_country]);
				  

				  
			var yAxis = d3.svg.axis() 
                  .scale(yScale2)
                  .orient("left")
				  .tickFormat(d3.format("100%"));

				  
			// Define 'div' for tooltips
			var div = d3.select("body").append("div")   
				.attr("class", "tooltip")               
				.style("opacity", 0);
				
			var svg = d3.select("#chart").append("svg") // draw main windows
			  .attr("width", width + margin.left + margin.right)
			  .attr("height", height + margin.top + margin.bottom)
			  .append("g")
			  .attr("class", "heatmap")	
			  .attr("transform", "translate(" + margin.left_page   + "," + margin.top_page  + ")"); 
			  

			svg.append("g") // draw axis
				.attr("class", "axis")
				.attr("transform", "translate(" + (XgridSize/2)+ "," + (yScale(nb_site+1)) + ")")
				.call(xAxis);
			
			for (i = 0; i < 4; i++ ){ // draw legend 
				legend_gen(xScale(nb_country+1) + 5, YgridSize*(0.1+i) , XgridSize*5, YgridSize*0.8,YgridSize*(0.7+i),hdi_label[i],color_hdi[i], select_hdi,i);
			}

			svg.append("g") // draw axis
				.attr("class", "axis2")
				.attr("transform", "translate(-302,0)")
				.call(yAxis);	
			svg.selectAll("rect2")	// draw stack bar
				.data(bar_stack)
				.enter()
				.append("rect")
				.attr("class", "rect_stack")
				.classed("bordered", true)
				.attr("width", 30)
				.attr("height", function(d,i) {return rev_yScale2(d.values);})
				.attr("y", function(d,i) {return rev_yScale2(d.x);})
				.attr("x", -300)
				.attr("fill", function(d,i) {return color_cancer[d.cancer];})
				.on("mouseover", function(d) {      
					div.transition()        
						.duration(200)      
						.style("opacity", .9);      
					div.html("<strong>" + d.cancer + ":</strong><br/>"+ d.cases + " cases<br/>" + Math.round(d.values*100*10)/10 + "%")  
						.style("left", (d3.event.pageX) + "px")     
						.style("top", (d3.event.pageY) + "px");    
					})                  
				.on("mouseout", function(d) {       
					div.transition()        
						.duration(500)      
						.style("opacity", 0);   
				});
				
			svg.append("text") // draw  title
				.attr("class", "title")
				.attr("x", (XgridSize * nb_country) / 2    )
				.attr("y", 0 - 10   )
				.attr("text-anchor", "middle")  
				.style("font-size", "25px") 
				.text(sex_select); 
				
			 
			 svg.append("text") // draw  axis title
				.attr("class", "axis_title")
				.attr("transform","translate(" + ((XgridSize * nb_country) / 2) +  "," + (yScale(nb_site+1) + 35) + ")" ) 
				.attr("text-anchor", "middle")
				.attr("font-family", "sans-serif")
				.attr("font-size", "15px")
				.attr("fill", "black")
				.attr("x", 0 )
				.attr("y", 0 )
				.text("ASR (world) ranking");

			
			
			var heatMap = svg.selectAll() // make 1 group for each cancer sites 
              .data(data_cancer)
              .enter()
			  .append("g")
			  .attr("class", function(d,i) { return "bar" + " bar" + d.key;} )
			  .attr("transform",function(d,i) {return "translate(0," +yScale(i+1) + ")";});
			  
			 heatMap // add label for each group
			  .append("text")
			  .attr("class", "column_label")		
			  .attr("text-anchor", "end")
			  .attr("id", function(d, i) { return d.key;})
			  .attr("transform",function(d,i) {return "translate(" +label_padding + "," +YgridSize/1.5 + ")";})
			  .text(function(d) {return d.key;});
			  
			heatMap // add line for each group
				.append("line")
				.attr("class", "line_stack2") 
				.attr("x1", -200)
				.attr("y1", function(d,i) {return YgridSize/2;})
				.attr("x2", function(d,i) {
						var temp = document.getElementById(d.key).getBBox().width;
						return (temp*-1)-10;
				})
				.attr("y2", function(d,i) {return YgridSize/2;})
				.attr("stroke-width", 0.5)
				.attr("stroke", "black");
			  

			svg.selectAll("line2")
				.data(bar_stack)
				.enter()
				.append("line")
				.attr("class", "line_stack1")
				.attr("x1", -270)
				.attr("y1", function(d,i) {return  rev_yScale2(d.x)+(rev_yScale2(d.values)/2);})
				.attr("x2", -200)
				.attr("y2", function(d,i) {return yScale(i+1)+(YgridSize/2);})
				.attr("stroke-width", 0.5)
				.attr("stroke", "black");
				


				

			
			heatMap.selectAll("rect") // draw each rectangle in the group
			   .data(function(d) {return d.values})
			   .enter()	
			   .append("rect")
			  .attr("class", function(d,i) { return "element" + " element" + d.hdi_group +" co_lab" + d.country_code+ " area" + d.area_code;})
			  .classed("bordered", true)
              .attr("x", function(d,i) { return xScale(nb_country+1-d.worldrank); })
              .attr("y", 0)
			  .attr("rx", 1)
              .attr("ry", 1)
              .attr("width", XgridSize)
              .attr("height", YgridSize)
			  .attr("fill", function(d,i)  {return color_hdi[d.hdi_group];});
			  
			heatMap.selectAll("rect")  // action with the mouse on the rectangle
			  .on("mouseover", function(d) {
				var xPosition = parseFloat(d3.select(this).attr("x")) ;
				var yPosition = parseFloat(d3.select(this).attr("y")) ;
				
				 svg.append("rect")
					.attr("id", "recttip")
					.classed("bordered", true)
					.attr("x", xScale(nb_country+1) + 5 )
					.attr("y", yScale(nb_site - 4 ) + 5  )
					.attr("rx", 10)
					.attr("ry", 10)
					.attr("width", 200)
					.attr("height", 100)
					.attr("opacity",0.8)
					.attr("fill", color_hdi[d.hdi_group]);
				svg.append("text")
					.attr("id", "titletip")
					.attr("x", xScale(nb_country+1) +100 )
					.attr("y", yScale(nb_site - 4) + 5 + 20  )
					.attr("text-anchor", "middle")
					.attr("font-family", "sans-serif")
					.attr("font-size", "15px")
					.attr("font-weight", "bold")
					.attr("fill", "black")
					.text(d.cancer)
				svg.append("text")
					.attr("id", "tooltip")
					.attr("x", xScale(nb_country+1) +100 )
					.attr("y", yScale(nb_site - 4) + 5 + 35    )
					.attr("text-anchor", "middle")
					.attr("font-family", "sans-serif")
					.attr("font-size", "12px")
					.attr("font-weight", "bold")
					.attr("fill", "black")
					.text(d.label_country);
				svg.append("text")
					.attr("id", "asrtip")
					.attr("x", xScale(nb_country+1) +100 )
					.attr("y",yScale(nb_site - 4) + 5 + 55   )
					.attr("text-anchor", "middle")
					.attr("font-family", "sans-serif")
					.attr("font-size", "12px")
					.attr("fill", "black")
					.text("ASR(World): " + d.asr)
				svg.append("text")
					.attr("id", "hditip")
					.attr("x", xScale(nb_country+1) +100 )
					.attr("y", yScale(nb_site - 4) + 5 + 70    )
					.attr("text-anchor", "middle")
					.attr("font-family", "sans-serif")
					.attr("font-size", "12px")
					.attr("fill", "black")
					.text("HDI: " + d.hdi_value)
				svg.append("text")	
					.attr("id", "areatip")
					.attr("x", xScale(nb_country+1) +100  )
					.attr("y", yScale(nb_site - 4) + 5 + 85    )
					.attr("text-anchor", "middle")
					.attr("font-family", "sans-serif")
					.attr("font-size", "12px")
					.attr("fill", "black")
					.text(d.area)
					}
				)
				
			  .on("mouseout", function() {
				d3.select("#recttip").remove();
				d3.select("#tooltip").remove();
				d3.select("#titletip").remove();
				d3.select("#asrtip").remove();
				d3.select("#hditip").remove();
				d3.select("#areatip").remove();
			})
			
				.on("click", function(d,i) {
					selected_country(data, d.country_code);});
			}
		);	
			
	}
		
	
		function bar_stack_data(data, data_cancer) {
		
		
			var sumTotal = d3.sum(data, function(d) {return d.cases})

				
			var sumOfCases = d3.nest()
				.key(function(d) {return d.cancer;})
				.rollup(function(v) {return (d3.sum(v, function(d) {return d.cases;}))  ;})
				.entries(data)

			var temp_stack = [];
			for (i=0; i<Object.keys(sumOfCases).length; i++ ) {
				temp_stack.push({
					cancer: sumOfCases[i].key,
					values: sumOfCases[i].values/sumTotal,
					cl_ord: data_cancer[i].values[0].cl_ord,
				});
			}
			temp_stack.sort(function(x, y){
				return d3.ascending(x.cl_ord, y.cl_ord);
			})
			var cl_stack = [];
			cl_stack.push({
				cancer: temp_stack[0].cancer,
				x_cl: 0,
				cl_ord: temp_stack[0].cl_ord
			})

			var temp = 0;
			for (i=1; i<Object.keys(sumOfCases).length; i++ ) {
				cl_stack.push({
					cancer: temp_stack[i].cancer,
					x_cl: temp_stack[i-1].values + temp,
					cl_ord: temp_stack[i].cl_ord
				})
				temp = temp_stack[i-1].values + temp;
			}
			cl_stack.sort(function(x, y){
				return d3.ascending(x.cancer, y.cancer);
			})
			var x_stack = [];
			x_stack.push(0);
			var temp = 0;
			for (i=1; i<Object.keys(sumOfCases).length; i++ ) {
				x_stack.push(sumOfCases[i-1].values/sumTotal + temp);
				temp = sumOfCases[i-1].values/sumTotal + temp;
			}
			
			var bar_stack = [];

 			for (i=0; i<Object.keys(sumOfCases).length; i++ ) {
				bar_stack.push({
					cancer: sumOfCases[i].key,
					values: sumOfCases[i].values/sumTotal,
					x: x_stack[i],
					x_cl : cl_stack[i].x_cl,
					cl_ord :  cl_stack[i].cl_ord,
					cases: sumOfCases[i].values
				});
		
			}
			
		
		
		
		return bar_stack;
		}
		
				

	
		var select_hdi = function(hdi_group) { // show only 1 hdi category
		
		if (!Flag_selected_country) {
		
			if (sex_select == "Women") {
				
			var file_use = "data/HDI_ASR_women_new.csv"; 
			}
					
			else {

				var file_use = "data/HDI_ASR_men_new.csv";  
			}
			
			d3.csv(file_use,
			
			function(d) {
			return {
				
				cl_ord : +d.cl_ord,
				cancer : d.cancer,
				area : d.area,
				area_code : +d.area_code,
				label_country: d.label_country,
				asr: +d.asr,
				worldrank: +d.worldrank,
				hdi_group: +d.hdi_group,
				cancer_code: +d.cancer_code,
				hdi_value: +d.hdi_value,
				cases: +d.cases,
				country_code: +d.country_code

				};	
			},		
			function(data) {
			
			if (element_display == true) {	
				
				var datatemp = data;
			}
			else {
			var datatemp = data.filter(function(d){
			return (d.hdi_group == hdi_group)
			});
			}
			
			
			var data_cancer=d3.nest()
				.key(function(d) {return d.cancer;})
				.sortKeys(d3.ascending)
				.entries(datatemp)
				
			bar_stack = bar_stack_data(datatemp, data_cancer);
			
			d3.select(".heatmap").selectAll(".rect_stack")	
				.data(bar_stack)
				.transition()
				.duration(transitionTime)
				.attr("height", function(d,i) {return rev_yScale2(d.values);})
				.attr("y", function(d,i) {
						if (row_select == "Cluster") {	
						return rev_yScale2(d.x_cl);
						}
					else {return rev_yScale2(d.x);}
					})
					
			d3.select(".heatmap").selectAll(".line_stack1")
				.data(bar_stack)
				.transition()
				.duration(transitionTime)
				.attr("y1", function(d,i) {
				if (row_select == "Cluster") {
					return rev_yScale2(d.x_cl)+(rev_yScale2(d.values)/2);
				}
				else {
					return rev_yScale2(d.x)+(rev_yScale2(d.values)/2);
				}
				})
				.attr("stroke-width", 0.5)
				.attr("stroke", "black");
			})	
			
			if (element_display == false) {			
				d3.select("#chart").selectAll(".element")
				.style("display", "inline");
				}
			else {
				d3.select("#chart").selectAll(".element:not(.element" + hdi_group +")")
					.style("display", "none");
			}
			element_display = !(element_display);
		}
		};
			
		var legend_gen = function(x, y , width, height,text_y,text,fill,onclick,onclick_arg) { // function to create legend 
		
			d3.selectAll(".heatmap").append("rect")
				.attr("x", x)
				.attr("y", y)
				.attr("class", "rect_legend")
				.classed("bordered", true)
				.attr("rx", 1)
				.attr("ry", 1)
				.attr("width", width)
				.attr("height", height )
				.attr("fill",  fill)
				.on("click", function() {  onclick(onclick_arg);});
				
			d3.selectAll(".heatmap").append("text")
				.attr("x", x + width  +2  )
				.attr("y", text_y  )
				.attr("class", "text_legend")
				.attr("text-anchor", "Left")
				.attr("font-family", "sans-serif")
				.attr("font-size", "12px")
				.attr("fill", "black")
				.text(text);
				
		};
		
		var populateComboCountry = function(data) {
		
			var datatemp = data.filter(function(d){
			return (d.cancer_code == 1)
			});
			
			var country_list = {};
			for (i=0;i<nb_country; i++ ) {
				country_list[datatemp[i].label_country]=datatemp[i].country_code;
			}
			
			country_text = Object.keys(country_list);
			country_text.sort();
			
			
 			
			var select  = document.getElementById("countryList")
			
			for (i=0; i < nb_country; i++ ) {
				var el = document.createElement("option");
				var temp=country_text[i]
				el.textContent = temp;
				el.value =country_list[temp];
				select.appendChild(el);
			}
		}
		
		
		
		function combo_country(thelist)
	    {
		if (sex_select == "Women") {
			var file_use = "data/HDI_ASR_women_new.csv"; 
		}	
		else {
			var file_use = "data/HDI_ASR_men_new.csv"; 
		}

			d3.csv(file_use,
				function(d) {
				return {
					cl_ord : +d.cl_ord,
					cancer : d.cancer,
					area : d.area,
					area_code : +d.area_code,
					label_country: d.label_country,
					asr: +d.asr,
					worldrank: +d.worldrank,
					hdi_group: +d.hdi_group,
					cancer_code: +d.cancer_code,
					hdi_value: +d.hdi_value,
					cases: +d.cases,
					country_code: +d.country_code
					};	
				},		
				function(data) {
		
				var idx_1 = thelist.selectedIndex;
				country_select = thelist.options[idx_1].value;
				Flag_selected_country = false
				if (country_select == 0 ){Flag_selected_country = true;}
				selected_country(data, country_select);
				
				}
			)
		}


		var selected_country = function(data,country_code) { // function to show only one country
			element_display = true		
			
			if (Flag_selected_country == false) {
			
				var datatemp = data.filter(function(d)
				{
				return (d.country_code == country_code)
				});
			}
			else {
			datatemp = data;
			}

			var data_cancer=d3.nest()
				.key(function(d) {return d.cancer;})
				.sortKeys(d3.ascending)
				.entries(datatemp)
			
			bar_stack = bar_stack_data(datatemp, data_cancer);
			
			d3.select(".heatmap").selectAll(".rect_stack")	
				.data(bar_stack)
				.transition()
				.duration(transitionTime)
				.attr("height", function(d,i) {return rev_yScale2(d.values);})
				.attr("y", function(d,i) {
						if (row_select == "Cluster") {	
						return rev_yScale2(d.x_cl);
						}
					else {return rev_yScale2(d.x);}
					})

			if (Flag_selected_country == false) {
			
				d3.select("#chart")
				.selectAll(".column_label")
				.data(datatemp)
				.transition()
				.duration(500)
				.attr("x", function(d) {return xScale(nb_country+1 - d.worldrank) ;});
		
				d3.select("#chart")
				.transition()
				.selectAll(".element")
				.style("display", "none");
				
				d3.select("#chart")
				.transition()
				.selectAll(".element.co_lab" + country_code)
				.style("display", "inline");
				
				d3.select("#chart")
				.selectAll(".title")
				.data(datatemp)
				.text( function(d) {return sex_select + ", " + d.label_country;});
				
				}
			
			else {
			
				d3.select("#chart")
				.selectAll(".column_label")
				.transition()
				.duration(500)
				.attr("x", 0)
				
				d3.select("#chart")
				.selectAll(".element")
				.transition()
				.delay(500)
				.style("display", "inline");
				
				d3.select("#chart")
				.selectAll(".title")
				.text(sex_select);
				
				document.getElementById('countryList').selectedIndex = 0;
				
			}
			
			d3.select(".heatmap").selectAll(".line_stack1")
				.data(bar_stack)
				.transition()
				.duration(transitionTime)
				.attr("y1", function(d,i) {
				if (row_select == "Cluster") {
					return rev_yScale2(d.x_cl)+(rev_yScale2(d.values)/2);
				}
				else {
					return rev_yScale2(d.x)+(rev_yScale2(d.values)/2);
				}
				})
				.attr("stroke-width", 0.5)
				.attr("stroke", "black");
				
			Flag_selected_country = !Flag_selected_country
		};

		
		
		var sortBars = function() { // fonction to change batr orders
		
		
		if (sex_select == "Women") {
				
			var nb_site = 25;  // Sex change  25
			var cl_2 = 21 // Sex change 21
			var cl_1 = 16
			
		}
				
		else {
		
			var nb_site = 23;  
			var cl_2 = 20; 
			var cl_1 = 17; 
		}
		
 		d3.select(".heatmap").selectAll(".rect_stack")	
				.transition()
				.duration(transitionTime)
				.attr("y", function(d,i) {
					if (row_select == "Cluster") {	
						return rev_yScale2(d.x_cl);
						}
					else {return rev_yScale2(d.x);
					}
				})
				.attr("fill", function(d,i) {
					if (row_select == "Cluster") {
						
						if (d.cl_ord < cl_1) {return  "#2C7BB6";}
						else if (d.cl_ord >=cl_1 & d.cl_ord < cl_2) {return  "#E66101";}
						else if (d.cl_ord >=cl_2) {return  "#33A02C";}
						}
					else {return  color_cancer[d.cancer];}
				});

        d3.select("g").selectAll(".bar")
           .transition()
           .duration(transitionTime)
		   .attr("transform", function(d, i) { 
			var cl_ord = d3.values(d)[1][1].cl_ord;
			if (row_select == "Cluster") {	
					
					if (cl_ord < cl_1) {cl_px = 0;}
					else if (cl_ord >=cl_1 & cl_ord < cl_2) {cl_px = 8;}
					else if (cl_ord >=cl_2) {cl_px = 16;}
					
					return "translate(0," +(yScale(cl_ord)+cl_px) + ")";
				}
				
				else {return"translate(0," +yScale(i+1) + ")";};	
           })

		d3.select(".heatmap").selectAll(".column_label")		
           .transition()
           .duration(transitionTime)	
		   .each("start", function(d,i) {	
				if (typeof d.cl_ord === "undefined") {
					var cl_ord = d3.values(d)[1][1].cl_ord;
				}
				else {
					var cl_ord = d.cl_ord
				}
				if (row_select == "Alphabetic") {
				d3.select(this)
						.classed("text-highlight_orange", false)
						.classed("text-highlight_blue", false)
						.classed("text-highlight_green", false)					
						}
				})
		   .each("end", function(d,i) {	 
				if (typeof d.cl_ord === "undefined") {
					var cl_ord = d3.values(d)[1][1].cl_ord;
				}
				else {
					var cl_ord = d.cl_ord
				}
				if (row_select == "Cluster") {
				d3.select(this)
						.classed("text-highlight_orange", function(d,i) {return (cl_ord >= cl_1 & cl_ord < cl_2);})
						.classed("text-highlight_blue", function(d,i) {return cl_ord <cl_1 ;})	
						.classed("text-highlight_green", function(d,i) {return (cl_ord >= cl_2);})
						}
				});
		d3.select(".heatmap").selectAll(".line_stack1")
			.data(bar_stack)
			.transition()
			.duration(transitionTime)
			.attr("y1", function(d,i) {
				if (row_select == "Cluster") {
					return rev_yScale2(d.x_cl)+(rev_yScale2(d.values)/2);
				}
				else {
					return rev_yScale2(d.x)+(rev_yScale2(d.values)/2);
				}
				})
				.attr("y2", function(d,i) {
				if (row_select == "Cluster") {
					
					if (d.cl_ord < cl_1) {cl_px = 0;}
					else if (d.cl_ord >=cl_1 & d.cl_ord < cl_2) {cl_px = 8;}
					else if (d.cl_ord >=cl_2) {cl_px = 16;}
				
					return yScale(d.cl_ord)+(YgridSize/2)+cl_px;
				}
				else {
					return yScale(i+1)+(YgridSize/2);
				}
			})
			.attr("stroke-width", 0.5)
			.attr("stroke", "black");
				
				
		d3.select(".heatmap").selectAll(".axis")		
           .transition()
           .duration(transitionTime)
		   .attr("transform", function() {
				if (row_select == "Alphabetic") {
					return  ("translate(" + ((XgridSize/2))+ "," + (yScale(nb_site+1)) + ")");}
				else {return  ("translate(" + (XgridSize/2)+ "," + (yScale(nb_site+1)+16) + ")");}
				});
				
		d3.select("#chart").selectAll(".axis_title")		
           .transition()
           .duration(transitionTime)
		   .attr("transform", function() {
				if (row_select == "Alphabetic") {
					return  ("translate(" + (XgridSize * nb_country) / 2 +  "," + (yScale(nb_site+1) + 35) + ")" );}
				else {return  ("translate(" + (XgridSize * nb_country) / 2 +  "," + (yScale(nb_site+1) + 35 + 16) + ")" );}
				});
		};
		
		
		
		var area_fill = function(svg) { // function to show country by area
		
		d3.select("#chart").selectAll(".rect_legend").remove();
		d3.select("#chart").selectAll(".text_legend").remove();
        d3.select("#chart").selectAll(".element")
           .transition()
           .duration(1000)
		   .attr("fill", function(d,i)  {
					if (fill_select == "hdi") {
						return color_hdi[d.hdi_group];}
					else { return color_area[(d.area_code)-1];}
					});
					
			if (fill_select == "hdi") {
				for (j	 = 0; j < 4; j++ ){
					legend_gen(xScale(nb_country+1) + 5, YgridSize*(0.1+j) , XgridSize*5, YgridSize*0.8,YgridSize*(0.7+j),hdi_label[j],color_hdi[j], select_hdi,j);
				}
			}
		
			else {
				for (j = 0; j < 6; j++ ){
					legend_gen(xScale(nb_country+1) + 5, YgridSize*(0.1+j) , XgridSize*5, YgridSize*0.8,YgridSize*(0.7+j),area_label[j],color_area_legend[j]);
				}
			}
			};
			
	</script >
	
	 
	</head>
  	
	<body>
	
	<div id="header" >
		<div>
			<h1><a href="#"> Cancer and HDI heatmap</a></h1>
			<div class="desc">
				Profiling The Diversity Of Cancer According To Human Development
			</div>
		</div>		
	
	</div>
	
	<div id="option">
	
	<form>
    <h4>Sex</h4>
    <label><input type="radio" id="radio_sex_female" name="sex" checked="checked"  onChange="combo_sex('Women')"> Female</label>
    <label><input type="radio" id="radio_sex_male"  name="sex" onChange="combo_sex('Men')"> Male</label>
	</form>
	
	<form>
    <h4>Clustering</h4>
    <label><input type="radio" id="radio_cluster_off"  name="cluster" checked="checked"   onChange="combo_row('Alphabetical')"> Off</label>
    <label><input type="radio" id="radio_cluster_on"   name="cluster" onChange="combo_row('Cluster')"> On</label>
	</form>
	
	<form>
    <h4>Color</h4>
    <label><input type="radio" id="radio_color_hdi"  name="color" checked="checked" value="hdi" onChange="combo_fill('hdi')"> HDI</label>
    <label><input type="radio" id="radio_color_area" name="color" value="area" onChange="combo_fill('test')"> Area</label>
	</form>
	
	<form class="comboCountry">
	
	<h4>Country</h4>
	<select name="country_select" id="countryList" onChange="combo_country(this)">
	 <option value=0>All countries</option>
	</select> 
	</form>
	
	</div>
	
	<div id="chart"></div>
	
	
		
		

		
		


 

  
</body>
 
</html>
	